{% extends "layouts/base.html" %}

{% block title %}{{ post.title }} - The Robot Overlord{% endblock %}

{% block content %}
<div class="post-detail">
    <div class="post-header">
        <h1>{{ post.title }}</h1>
        <div class="post-meta">
            <div class="user-info">
                <strong>{{ post.author.username }}</strong>
                <div class="stats">
                    <span class="approved">✓ {{ post.author.approved_count }}</span>
                    <span class="rejected">✗ {{ post.author.rejected_count }}</span>
                </div>
            </div>
            <span>Topic: <a href="/html/topics/{{ post.topic.id }}/">{{ post.topic.title }}</a></span>
            <span>Posted: {{ post.created_at|datetime }}</span>
        </div>
    </div>

    <div class="post-content">
        {{ post.content|nl2br }}
    </div>
</div>

<div class="post-replies">
    <h2>APPROVED REPLIES</h2>

    {% if replies %}
        <div class="replies-list">
            {% for reply in replies %}
                <div class="post reply">
                    <div class="user-info">
                        <strong>{{ reply.author.username }}</strong>
                        <div class="stats">
                            <span class="approved">✓ {{ reply.author.approved_count }}</span>
                            <span class="rejected">✗ {{ reply.author.rejected_count }}</span>
                        </div>
                    </div>
                    <div class="reply-content">
                        {{ reply.content|nl2br }}
                    </div>
                    <div class="post-meta">
                        <span>Posted: {{ reply.created_at|datetime }}</span>
                    </div>
                </div>
            {% endfor %}
        </div>

        {% if pagination %}
        <div class="pagination">
            {% if pagination.has_previous %}
                <a href="/html/posts/{{ post.id }}/?page={{ pagination.previous_page }}">Previous</a>
            {% endif %}

            <span>Page {{ pagination.current_page }} of {{ pagination.total_pages }}</span>

            {% if pagination.has_next %}
                <a href="/html/posts/{{ post.id }}/?page={{ pagination.next_page }}">Next</a>
            {% endif %}
        </div>
        {% endif %}
    {% else %}
        <p>NO REPLIES HAVE BEEN APPROVED FOR THIS POST</p>
    {% endif %}
</div>

{% if user %}
<div class="create-reply">
    <h2>SUBMIT REPLY</h2>
    <form action="/html/posts/{{ post.id }}/reply/" method="post">
        <div class="form-group">
            <label for="content">Content:</label>
            <textarea id="content" name="content" rows="4" required></textarea>
        </div>

        <button type="submit">SUBMIT FOR APPROVAL</button>
    </form>
</div>
{% endif %}
{% endblock %}
